<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trade Interview Scheduling Form</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
</head>

<body>

<!-- =========================
     Form Header
========================= -->
<header class="form-header">
  <div class="header-left">
    <img src="/EMI%20Logo.jpg" alt="Company Logo" class="logo" />
  </div>

  <div class="header-text">
    <h1>Trade Interview Scheduling Form</h1>
    <p>
      Welcome to the Trade Interview Scheduling Form. This form is designed to
      capture all necessary details for scheduling a trade interview.
    </p>
  </div>
</header>
<form id="tradeInterviewForm">
<!-- =========================
     Research Project Section
========================= -->
<section class="form-section">
  <h2>Which Research Project(s) is this Interview for?</h2>

  <div class="form-grid">
    <div class="form-group">
      <label for="country">Country (MDR)</label>
      <select id="country" name="country" required></select>
    </div>

    <div class="form-group">
      <label for="industry">Industry (MDR)</label>
      <select id="industry" name="industry" multiple required>
      </select>
    </div>

    <div class="form-group">
      <label for="category">Category (MDR)</label>
      <select id="category" name="category" multiple required>
        <option value="">Select category</option>
      </select>
    </div>

    <div class="form-group">
      <label for="projectEdition">Project Edition</label>
      <input type="text" id="projectEdition" name="projectEdition" required />
    </div>

    <div class="form-group">
      <label for="interviewer">Interviewer</label>
      <input type="text" id="interviewer" name="interviewer" required />
    </div>

    <div class="form-group">
      <label for="interviewerEmail">Interviewer Email</label>
      <input type="email" id="interviewerEmail" name="interviewerEmail" required />
    </div>

    <div class="form-group">
      <label for="commissioner">Commissioner</label>
      <input type="text" id="commissioner" name="commissioner" required />
    </div>

    <div class="form-group">
      <label for="commissionerEmail">Commissioner Email</label>
      <input type="email" id="commissionerEmail" name="commissionerEmail" required />
    </div>
  </div>
</section>

<!-- =========================
     Interviewee Details
========================= -->
<section class="form-section">
  <h2>Interviewee’s Details</h2>

  <div class="form-grid">
    <div class="form-group">
      <label>First Name *</label>
      <input type="text" name="firstName" required />
    </div>

    <div class="form-group">
      <label>Surname *</label>
      <input type="text" name="surname" required />
    </div>

    <div class="form-group">
      <label>Email *</label>
      <input type="email" name="email" required />
    </div>

    <div class="form-group">
      <label>Phone</label>
      <input type="tel" name"phone" />
    </div>

    <div class="form-group">
      <label>Job Title *</label>
      <input type="text" name="jobTitle" required />
    </div>

    <div class="form-group">
      <label>Company Name (MDR) *</label>
      <select id="company" name="company" required>
        <option value="">Select company</option>
      </select>
    </div>

    <div class="form-group">
      <label>Business Function *</label>
      <input type="text" name="businessFunction" required />
    </div>

    <div class="form-group">
      <label>Time Spent in Role (years) *</label>
      <input type="number" name="timeInRole" min="0" required />
    </div>

    <div class="form-group">
      <label>Interviewee Country (MDR) *</label>
      <select id="intervieweeCountry" name="intervieweeCountry" required></select>
    </div>

    <div class="form-group">
      <label>Type of Interview *</label>
      <select name="interviewType" required>
        <option value="">Select type</option>
        <option>Full Interview with Old Contact</option>
        <option>Full Interview with New Contact</option>
        <option>Relationship Building with Old Contact</option>
        <option>Relationship Building with New Contact</option>
        <option>Pulse Interview with Old Contact</option>
        <option>Pulse Interview with New Contact</option>
        <option>Trade Fair Interview with Old Contact</option>
        <option>Trade Fair Interview with New Contact</option>
      </select>
    </div>
  </div>

  <div class="form-group">
    <label>Professional History</label>
    <textarea name="professionalHistory" rows="4"></textarea>
  </div>
</section>

<!-- =========================
     Trade Interview Details
========================= -->
<section class="form-section">
  <h2>Trade Interview Details</h2>

  <div class="form-grid">
    <div class="form-group">
      <label>Date of Interview *</label>
      <input type="date" name="interviewDate" required />
    </div>

    <div class="form-group">
      <label>Time Zone *</label>
      <select name="timeZone" required>
        <option value="">Select time zone</option>
        <option>GMT Standard Time</option>
        <option>Central Standard Time</option>
        <option>Singapore Standard Time</option>
        <option>China Standard Time</option>
        <option>India Standard Time</option>
        <option>FLE Standard Time</option>
        <option>Arabian Standard Time</option>
        <option>Pacific SA Standard Time</option>
        <option>South Africa Standard Time</option>
        <option>AUS Eastern Standard Time</option>
        <option>Tokyo Standard Time</option>
        <option>E. South America Standard Time</option>
        <option>Korea Standard Time</option>
      </select>
    </div>

    <div class="form-group">
      <label>Time of Interview *</label>
      <input type="time" name="interviewTime" required />
    </div>

    <div class="form-group">
      <label>Duration (minutes) *</label>
      <input type="number" name="duration" min="0" max="300" required />
    </div>
  </div>
</section>

<section class="form-section">
  <button type="submit" class="submit-btn">Submit Interview Request</button>
</section>
</form>

<!-- =========================
     SCRIPT
========================= -->
<script>

/* =========================
   Countries
========================= */

const countries = [
  "United Kingdom","United States","India","China","Singapore",
  "Australia","Germany","France","Brazil","South Africa",
  "Japan","South Korea","UAE","Saudi Arabia"
];

function populateCountries(id) {
  const select = document.getElementById(id);
  select.innerHTML = '<option value="">Select country</option>';
  countries.forEach(c => {
    const opt = document.createElement("option");
    opt.value = c;
    opt.textContent = c;
    select.appendChild(opt);
  });
}

populateCountries("country");
populateCountries("intervieweeCountry");


/* =========================
   Industry → Category → Company
========================= */

let referenceData = [];

let industryChoices;
let categoryChoices;

const industrySelect = document.getElementById("industry");
const categorySelect = document.getElementById("category");
const companySelect = document.getElementById("company");


async function loadReferenceData() {

  const response = await fetch("/api/referenceData");
  referenceData = await response.json();

  // Get unique industries
  const industries = [...new Set(referenceData.map(r => r.industry))];

  // Initialize Industry Choices
  industryChoices = new Choices(industrySelect, {
    removeItemButton: true,
    searchEnabled: true,
    placeholder: true,
    placeholderValue: 'Select industry'
  });

  industryChoices.setChoices(
    industries.map(i => ({ value: i, label: i })),
    'value',
    'label',
    true
  );

  // Initialize empty Category Choices
  categoryChoices = new Choices(categorySelect, {
    removeItemButton: true,
    searchEnabled: true,
    placeholder: true,
    placeholderValue: 'Select category'
  });

}


/* =========================
   Industry Change
========================= */

industrySelect.addEventListener("change", () => {

  const selectedIndustries = industryChoices.getValue(true);

  categoryChoices.clearChoices();
  companySelect.innerHTML = '<option value="">Select company</option>';

  if (selectedIndustries.length === 0) return;

  const categories = [
    ...new Set(
      referenceData
        .filter(r => selectedIndustries.includes(r.industry))
        .map(r => r.category)
    )
  ];

  categoryChoices.setChoices(
    categories.map(c => ({ value: c, label: c })),
    'value',
    'label',
    true
  );

});


/* =========================
   Category Change
========================= */

categorySelect.addEventListener("change", () => {

  const selectedIndustries = industryChoices.getValue(true);
  const selectedCategories = categoryChoices.getValue(true);

  companySelect.innerHTML = '<option value="">Select company</option>';

  if (selectedIndustries.length === 0 || selectedCategories.length === 0) return;

  const companies = referenceData
    .filter(r =>
      selectedIndustries.includes(r.industry) &&
      selectedCategories.includes(r.category)
    )
    .map(r => r.company);

  const uniqueCompanies = [...new Set(companies)];

  uniqueCompanies.forEach(c => {
    const opt = document.createElement("option");
    opt.value = c;
    opt.textContent = c;
    companySelect.appendChild(opt);
  });

});


loadReferenceData();

</script>

<script src="form-data.js"></script>
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
</body>
</html>
